---
import { entityEnum } from "@utils/constants";
import InputGroup from "@components/InputGroup.astro";

const {
  name,
  type,
  personName,
  personAddress,
  personPin,
  companyName,
  companyAddress,
  companyPin,
} = Astro.props;
---

<data-selector>
  <InputGroup>
    <label for="type">Rodzaj podmiotu</label>
    <select id="type" name={`${name}Type`} value={type}>
      {
        entityEnum.map((entityType) => (
          <option selected={type === entityType}>{entityType}</option>
        ))
      }
    </select>
  </InputGroup>
  <fieldset
    data-type={entityEnum[0]}
    style={type === entityEnum[1] ? `display:none` : ``}
  >
    <InputGroup>
      <label for="personName">ImiÄ™ i nazwisko</label>
      <input
        id="personName"
        type="text"
        name={`${name}PersonName`}
        value={personName}
        class="flex-grow"
      />
    </InputGroup>
    <InputGroup>
      <label for="personAddress">Adres zamieszkania</label>
      <input
        id="personAddress"
        type="text"
        name={`${name}PersonAddress`}
        value={personAddress}
        class="flex-grow"
      />
    </InputGroup>
    <InputGroup>
      <label for="personPin">Numer PESEL</label>
      <input
        id="personPin"
        type="text"
        name={`${name}PersonPin`}
        value={personPin}
      />
    </InputGroup>
  </fieldset>
  <fieldset
    data-type={entityEnum[1]}
    style={type === entityEnum[0] ? `display:none` : ``}
  >
    <InputGroup>
      <label for="companyName">Nazwa firmy</label>
      <input
        id="companyName"
        type="text"
        name={`${name}CompanyName`}
        value={companyName}
        class="flex-grow"
      />
    </InputGroup>
    <InputGroup>
      <label for="companyAddress">Adres firmy</label>
      <input
        id="companyAddress"
        type="text"
        name={`${name}CompanyAddress`}
        value={companyAddress}
        class="flex-grow"
      />
    </InputGroup>
    <InputGroup>
      <label for="companyPin">Numer NIP</label>
      <input
        id="companyPin"
        type="text"
        name={`${name}CompanyPin`}
        value={companyPin}
      />
    </InputGroup>
  </fieldset>
</data-selector>

<style>
  data-selector {
    @apply flex flex-col gap-20;
  }
</style>

<script>
  class DataSelector extends HTMLElement {
    selector: HTMLSelectElement | null;
    fieldsets: NodeListOf<HTMLFieldSetElement>;

    constructor() {
      super();

      this.selector = this.querySelector("select");
      this.fieldsets = this.querySelectorAll("fieldset");
    }

    connectedCallback() {
      if (this.selector) {
        this.selector.addEventListener("change", () => {
          const activeTab = this.selector?.value;

          if (activeTab) {
            Array.from(this.fieldsets).forEach((fieldset) => {
              if (fieldset.getAttribute("data-type") === activeTab) {
                fieldset.removeAttribute("style");
              } else {
                fieldset.style.display = "none";
                const inputs = fieldset.querySelectorAll("input");

                if (Array.from(inputs).length) {
                  Array.from(inputs).forEach((input) => {
                    input.value = "";
                  });
                }
              }
            });
          }
        });
      }
    }
  }

  customElements.define("data-selector", DataSelector);
</script>
